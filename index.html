<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>Tính hiệu suất sản xuất</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f9f9f9; }
    h2 { color: #333; }
    label { display:block; margin-top:12px; font-weight:600; }
    input, select { padding:6px; width:220px; margin-top:4px; }
    button { margin-top:16px; padding:10px 20px; background:#4CAF50; border:none; color:#fff; cursor:pointer; }
    .small { font-size:0.9em; color:#555; margin-top:6px; }
    .result { margin-top:20px; padding:15px; background:#fff; border:1px solid #ccc; width:fit-content; }
  </style>
</head>
<body>
  <h2>Công cụ tính hiệu suất / sản lượng</h2>

  <label>Bạn muốn tính:</label>
  <select id="calcType" onchange="toggleInputs()">
    <option value="hieuSuat">Hiệu suất (%)</option>
    <option value="sanLuong">Sản lượng cần đạt</option>
  </select>

  <div>
    <div id="input-sanLuong">
      <label>Sản lượng (output thực tế):</label>
      <input type="number" id="sanLuong" min="0" step="1">
    </div>

    <div id="input-hieuSuat">
      <label>Hiệu suất mong muốn (%):</label>
      <input type="number" id="hieuSuat" min="0" step="0.01">
    </div>

    <label>SAM (phút / sản phẩm):</label>
    <input type="number" id="sam" min="0" step="0.01">

    <label>Số người đi làm:</label>
    <input type="number" id="people" min="0" step="1">

    <label>Số giờ thai sản:</label>
    <input type="number" id="maternity" min="0" step="0.01">

    <label>Số giờ được trừ:</label>
    <input type="number" id="deduct" min="0" step="0.01">

    <label>Số giờ tăng ca:</label>
    <input type="number" id="overtime" min="0" step="0.01">

    <div class="small">Tổng số giờ làm (tính tự động): <span id="totalHoursDisplay">-</span></div>

    <button type="button" onclick="calculate()">Tính toán</button>
  </div>

  <div class="result" id="result"></div>

  <script>
    function toggleInputs() {
      const type = document.getElementById("calcType").value;
      document.getElementById("input-sanLuong").style.display = (type === "hieuSuat") ? "block" : "none";
      document.getElementById("input-hieuSuat").style.display = (type === "sanLuong") ? "block" : "none";
      document.getElementById("result").innerHTML = "";
      updateTotalHoursDisplay();
    }

    function getNumber(id, defaultVal=0) {
      const v = parseFloat(document.getElementById(id).value);
      return Number.isFinite(v) ? v : defaultVal;
    }

    function updateTotalHoursDisplay() {
      const people = getNumber('people', 0);
      const maternity = getNumber('maternity', 0);
      const deduct = getNumber('deduct', 0);
      const overtime = getNumber('overtime', 0);
      const totalHours = (people * 8) + overtime - maternity - deduct;
      document.getElementById('totalHoursDisplay').textContent = (totalHours > 0) ? totalHours.toFixed(2) + ' giờ' : 'Không hợp lệ';
      return totalHours;
    }

    // cập nhật hiển thị tổng giờ khi thay input
    ['people','maternity','deduct','overtime'].forEach(id=>{
      document.getElementById(id).addEventListener('input', updateTotalHoursDisplay);
    });

    function calculate() {
      const type = document.getElementById("calcType").value;
      const sam = getNumber('sam', 0);
      const people = getNumber('people', 0);
      const maternity = getNumber('maternity', 0);
      const deduct = getNumber('deduct', 0);
      const overtime = getNumber('overtime', 0);

      if (sam <= 0 || people <= 0) {
        document.getElementById("result").innerHTML = "⚠️ Vui lòng nhập SAM và số người hợp lệ.";
        return;
      }

      const totalHours = (people * 8) + overtime - maternity - deduct;
      if (totalHours <= 0) {
        document.getElementById("result").innerHTML = "⚠️ Tổng số giờ làm việc không hợp lệ (<= 0).";
        return;
      }

      const totalMinutes = totalHours * 60;

      if (type === 'hieuSuat') {
        const sanLuong = getNumber('sanLuong', -1);
        if (sanLuong <= 0) {
          document.getElementById("result").innerHTML = "⚠️ Vui lòng nhập sản lượng hợp lệ.";
          return;
        }
        const hieuSuat = (sanLuong * sam) / totalMinutes * 100;
        document.getElementById("result").innerHTML = `<p><b>Hiệu suất: ${hieuSuat.toFixed(2)}%</b></p>`;
      } else {
        const hieuSuat = getNumber('hieuSuat', -1);
        if (hieuSuat <= 0) {
          document.getElementById("result").innerHTML = "⚠️ Vui lòng nhập hiệu suất hợp lệ.";
          return;
        }
        const sanLuong = (hieuSuat / 100) * totalMinutes / sam;
        document.getElementById("result").innerHTML = `<p><b>Sản lượng cần đạt: ${Math.round(sanLuong)}</b></p>`;
      }
    }

    // khởi tạo
    toggleInputs();
  </script>
</body>
</html>
